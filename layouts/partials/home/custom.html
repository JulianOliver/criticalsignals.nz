<!--modified hero layout-->

{{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
{{ $disableHeroImageFilter := .Site.Params.homepage.disableHeroImageFilter | default false }}
<article class="max-w-full prose dark:prose-invert">
  <div class="relative">
    <div class="absolute inset-x-0 bottom-0 h-1/2 bg-gray-100"></div>
    <div class="mx-auto max-w-7xl p-0">
      <!-- <div class="relative shadow-xl sm:overflow-hidden rounded-md"> -->
      <div class="relative shadow-xl sm:overflow-hidden">
        <div class="absolute inset-0">
          {{ $homepageImage := "" }}
          {{ with .Site.Params.defaultBackgroundImage }}
            {{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
              {{ $homepageImage = resources.GetRemote . }}
            {{ else }}
              {{ $homepageImage = resources.Get . }}
            {{ end }}
          {{ end }}
          {{ with .Site.Params.homepage.homepageImage }}
            {{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
              {{ $homepageImage = resources.GetRemote . }}
            {{ else }}
              {{ $homepageImage = resources.Get . }}
            {{ end }}
          {{ end }}
          {{ if $homepageImage }}
          <!-- <img class="h-full w-full object-cover m-0 nozoom" src="{{ $homepageImage.RelPermalink }}" style="margin: 0"> -->
          <img id="target-hero" class="h-full w-full object-cover m-0 nozoom" src="{{ $homepageImage.RelPermalink }}" style="margin: 0">
          {{ if not $disableHeroImageFilter }}
            <div
              class="absolute inset-0 bg-gradient-to-r from-primary-500 to-secondary-600 dark:from-primary-600 dark:to-secondary-800 mix-blend-multiply">
            </div>
          {{ else }}
            <div
              class="absolute inset-0 from-primary-500 to-secondary-600 dark:from-primary-600 dark:to-secondary-800 mix-blend-multiply">
            </div>
          {{ end }}
          {{ end }}
        </div>
        <!-- <div class="relative px-4 py-16 sm:px-6 sm:py-24 lg:py-32 lg:px-8 flex flex-col items-center justify-center text-center"> -->
        <div class="relative px-4 py-16 sm:px-6 sm:py-16 lg:py-16 lg:px-8 flex flex-col items-center justify-center text-center">

          <div class='homepage-hero'>
            <div id="target-question" class='question'>
              HOW MANY<br />
              DEVICES IS A<br />
              LIFETIME<br />
            </div>

            <img class='logo' src="/logo.svg" />
          </div>

        </div>
      </div>
    </div>
  </div>
</article>
<section class="prose prose-invert">
  {{ .Content }}
</section>
<section>
  {{ partial "recent-articles/main.html" . }}
</section>

<script>
// This bit handles the randomised questions + images

const questions = {{ .Params.questions }}
const images = {{ .Params.images }}

// Set a random text + image immediately
setHeroText()
setHeroImage()

// Set random text + image every N seconds
setInterval(setHeroText, 5000)   // 5s
setInterval(setHeroImage, 13000) // 13s


// Functions which take care of the logic of changing the page
function setHeroText () {
  const text = questions[random(questions.length)]
  const heroTextEl = document.getElementById('target-question')
  heroTextEl.innerText = text
}
function setHeroImage () {
  const url = images[random(images.length)]
  const heroImageEl = document.getElementById('target-hero')
  heroImageEl.setAttribute('src', url)
}

function random (n) {
  return Math.floor(Math.random() * n)
}
</script>

<style>
/*
I don't know if this is a terrible idea but it works?
I wanted to keep the _index.md relatively tidy for the people editing there
*/

/* Over-ride defaults for homepage */
.prose {
  max-width: 100%;
  margin-bottom: 3rem;
}

/* Modify the styles when the window is small */
@media (max-width: 768px) {
  article {
    margin-left: calc(var(--spacing) * -6);
    margin-right: calc(var(--spacing) * -6);
    max-width: calc(100% + calc(var(--spacing) * 12)) !important;
  }
}

.homepage-hero {
  height: 100%;
  width: 100%;
  min-height: 30rem;

  display: grid;
  align-content: space-between;

  .question {
    justify-self: start;
    max-width: 40rem;

    font-family: bold_font;
    font-size: 4rem;
    line-height: 4.5rem;
    text-align: start;

    filter: drop-shadow(0 0 5px rgba(0,0,0, 0.2));
  }

  .logo {
     justify-self: end;
     max-width: 60%;
     max-height: 5rem;

     filter: drop-shadow(0 0 5px rgba(0,0,0, 0.6));
  }
}
</style>
